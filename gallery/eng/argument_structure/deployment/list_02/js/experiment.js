/**
 * jsPsych 8.x Experiment
 * Generated by SASH deployment system
 *
 * Experiment: Sentence Acceptability Judgments
 * Description: Rate which sentence sounds more natural
 */

// Initialize jsPsych
const jsPsych = initJsPsych({
    on_finish: function() {
        
        // Display data (for testing)
        jsPsych.data.displayData();
        
    },
    show_progress_bar: true,
    auto_update_progress_bar: false,
});

// Add experiment metadata to all trials
jsPsych.data.addProperties({
    experiment_title: "Sentence Acceptability Judgments",
    participant_id: PARTICIPANT_ID,
    experiment_start_time: new Date().toISOString(),
});

// Build timeline
const timeline = [];

// Instructions trial

timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <div class="instructions">
            <h2>Instructions</h2>
            <p>You will see pairs of sentences. Please select the sentence that sounds more natural to you.</p>
            <p><em>Press any key to continue</em></p>
        </div>
    `,
        data: {
            trial_type: 'instructions'
        }
});


// Main experiment trials
const experimentTrials = TIMELINE_DATA.trials || [];


// Randomize trials with constraint satisfaction
const randomizedTrials = randomizeTrials(experimentTrials, PARTICIPANT_ID);
timeline.push(...randomizedTrials);


// Completion trial
timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <div class="completion">
            <h2>Complete</h2>
            <p>Thank you for participating!</p>
            
            <p><em>Press any key to view your data</em></p>
            
        </div>
    `,
    choices: "ALL_KEYS",
    trial_duration: null,
    data: {
        trial_type: 'completion'
    }
});

// Manual progress bar updates
let currentTrial = 0;
const totalTrials = experimentTrials.length;

jsPsych.opts.on_trial_start = function() {
    if (currentTrial <= totalTrials) {
        const progress = currentTrial / totalTrials;
        jsPsych.setProgressBar(progress);
        currentTrial++;
    }
};

// Run the experiment
jsPsych.run(timeline);



